<div class="forgot-password-container">
  <div class="forgot-password-card">
    <div class="forgot-password-header">
      <h2>Resetovanje Lozinke</h2>
      <p *ngIf="!showNewPasswordForm">Unesite email adresu za resetovanje lozinke</p>
      <p *ngIf="showNewPasswordForm">Unesite novu lozinku</p>
    </div>

    <form [formGroup]="forgotPasswordForm" class="forgot-password-form">
      
      <!-- Email Input -->
      <div class="form-group" *ngIf="!showNewPasswordForm">
        <label for="email">Email adresa *</label>
        <div class="input-container">
          <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
            <polyline points="22,6 12,13 2,6"></polyline>
          </svg>
          <input
            type="email"
            id="email"
            formControlName="email"
            class="form-control"
            [class.error]="hasError('email')"
            placeholder="vaš@email.com"
          />
        </div>
        <span class="error-message" *ngIf="hasError('email')">
          {{ getErrorMessage('email') }}
        </span>
      </div>

      <!-- New Password Section -->
      <div class="password-section" *ngIf="showNewPasswordForm">
        
        <!-- Email Display -->
        <div class="email-display">
          <span class="email-label">Email:</span>
          <span class="email-value">{{ forgotPasswordForm.get('email')?.value }}</span>
        </div>

        <!-- New Password -->
        <div class="form-group">
          <label for="newPassword">Nova lozinka *</label>
          <div class="input-container">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
            <input
              type="password"
              id="newPassword"
              formControlName="newPassword"
              class="form-control"
              [class.error]="hasError('newPassword')"
              placeholder="Unesite novu lozinku"
            />
          </div>
          <span class="error-message" *ngIf="hasError('newPassword')">
            {{ getErrorMessage('newPassword') }}
          </span>
        </div>

        <!-- Confirm Password -->
        <div class="form-group">
          <label for="confirmPassword">Potvrdite lozinku *</label>
          <div class="input-container">
            <svg class="input-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
            <input
              type="password"
              id="confirmPassword"
              formControlName="confirmPassword"
              class="form-control"
              [class.error]="hasError('confirmPassword') || forgotPasswordForm.errors?.['passwordMismatch']"
              placeholder="Ponovite novu lozinku"
            />
          </div>
          <span class="error-message" *ngIf="hasError('confirmPassword') || forgotPasswordForm.errors?.['passwordMismatch']">
            {{ getErrorMessage('confirmPassword') }}
          </span>
        </div>

        <!-- Password Requirements -->
        <div class="password-requirements">
          <h4>Zahtevi za lozinku:</h4>
          <ul>
            <li [class.valid]="isPasswordLengthValid()">
              Minimum 8 karaktera
            </li>
            <li [class.valid]="hasUpperCase()">
              Jedno veliko slovo
            </li>
            <li [class.valid]="hasLowerCase()">
              Jedno malo slovo
            </li>
            <li [class.valid]="hasNumber()">
              Jedan broj
            </li>
            <li [class.valid]="hasSpecialChar()">
              Jedan specijalni karakter
            </li>
          </ul>
        </div>
      </div>

      <!-- Messages -->
      <div class="global-error" *ngIf="errorMessage">
        <p>{{ errorMessage }}</p>
      </div>

      <div class="success-message" *ngIf="successMessage">
        <p>{{ successMessage }}</p>
      </div>

      <!-- Action Buttons -->
      <div class="button-group">
        <button
          type="button"
          *ngIf="!showNewPasswordForm"
          (click)="onSubmitEmail()"
          class="primary-button"
          [disabled]="isLoading || !forgotPasswordForm.get('email')?.valid"
        >
          {{ isLoading ? 'Šalje se...' : 'Pošaljite Email' }}
        </button>

        <button
          type="button"
          *ngIf="showNewPasswordForm"
          (click)="onSubmitNewPassword()"
          class="primary-button"
          [disabled]="isLoading || forgotPasswordForm.invalid"
        >
          {{ isLoading ? 'Menja se...' : 'Promenite Lozinku' }}
        </button>

        <button
          type="button"
          (click)="goToLogin()"
          class="secondary-button"
          [disabled]="isLoading"
        >
          Povratak na Login
        </button>
      </div>
    </form>
  </div>
</div>